<!DOCTYPE html>
<html>
<head>
	<title>Laboratorio 1 - RIA 2015</title>
	<meta charset="utf-8">

	<!--jQuery-->
	<script type="text/javascript" src="../js/jquery-2.1.3.min.js"></script>

	<!--jQuery Modal-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="../css/jquery.modal.css" type="text/css" rel="stylesheet" />
	<link href="../css/jquery.modal.theme-xenon.css" type="text/css" rel="stylesheet" />
	<link href="../css/jquery.modal.theme-atlant.css" type="text/css" rel="stylesheet" />
	<script type="text/javascript" src="../js/jquery.modal.js"></script> 

	<!-- Nuestros estilos -->
    <link rel="stylesheet" type="text/css" href="../css/estilo.css">
    <script type="text/javascript" src="../js/data.js"></script>	

	<!-- Shared assets -->
    <link rel="stylesheet" type="text/css" href="../css/carouselStyle.css">
	<!--Boostrap-->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

    <!-- Bootstrap FileStyle -->
	<script type="text/javascript" src="../js/bootstrap-select.js"></script>
	<script type="text/javascript" src="../js/bootstrap-filestyle.min.js"></script>
	<script type="text/javascript" src="../js/bootbox.min.js"></script>
	<link rel="stylesheet" href="../css/bootstrap-select.min.css">
	<link rel="stylesheet" href="../css/style.css">
	  <style>
	  .carousel-inner > .item > img,
	  .carousel-inner > .item > a > img {
	      width: 70%;
	      margin: auto;
	  }
	  </style>	
        
</head>
<body>

	<nav class="navbar navbar-inverse">
	  	<div class="container-fluid">
	    	<div class="navbar-header">
	      		<img class="imagen" src="../images/logotipoMin.png" alt="DRIMTIM">
	    	</div>
	    	<div>
		      	<ul class="nav navbar-nav">
		        	<li class="active"><a href="../index.html">Home</a></li>
		        	<!--<li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Page 1 <span class="caret">
		        	<span>
		        	</a>
		          		<ul class="dropdown-menu">
		            		<li><a href="#">Page 1-1</a></li>
		            		<li><a href="#">Page 1-2</a></li>
		            		<li><a href="#">Page 1-3</a></li>
		          		</ul>
		        	</li>-->
		        	<li><a href="#">Ver Imagenes</a></li>
		        	<li><a href="#">DRIMTIM</a></li>
		      	</ul>
		      	<ul class="nav navbar-nav navbar-right">
		        	<li><a href="../index.html"><span id="nombreUsu" class="glyphicon glyphicon-user">&nbsp;</span>
		        	</a></li>
		        	<li><a href="../index.html"><span class="glyphicon glyphicon-log-in"></span>&nbsp;&nbsp;Salir</a></li>
		      	</ul>
		    </div>
	  	</div>
	</nav>

	<header class="page-header">
		<h1>
			Laboratorio 1 - RIA 2015
		</h1>
	</header>

	<section class="main">
		<ul class="nav nav-tabs">
			<li id="linkIngresar" role="presentation"><a
				onclick="mostrarFuncionalidad('INGRESAR');">Ingresar</a></li>
			<li id="linkVer" role="presentation"><a
				onclick="mostrarFuncionalidad('VER');">Ver</a></li>
		</ul>
		<div id="formIngresar">
			
			<div class="panel panel-primary">
				<div class="panel-heading">
					<h3 class="panel-title">Ingresar Imágen</h3>
				</div>
				<div class="panel-body ingreso">
					<div class="img-thumbnail imagen input-group">
						<img id="miniatura" src="../images/upload.png" alt="Imágen" name="imagenUsuario">
					</div>
					<div class="imagenBuscar">
						<input id="archivoImagen" type="file" class="filestyle" data-buttonName="btn-primary"
						data-buttonText="Cargar Imagen ..." data-iconName="glyphicon-inbox" 
						data-buttonBefore="true" value="Subir Imagen..."
						onchange="cargarImagen(event);">
					</div>
					<br />
					<div class="input-group">
						<span class="input-group-addon" id="basic-addon1">Titulo: </span>
						<input id="tituloImagen" type="text" class="form-control"
							placeholder="Ingrese el título de la imágen..."
							aria-describedby="basic-addon1" name="tituloImagen">
					</div>
					<br />
					<div class="input-group">
						<span class="input-group-addon" id="basic-addon1">Descripción:
						</span>
						<textarea id="descripcionImagen" class="form-control"
							placeholder="Ingrese una descripción de la imágen..."
							aria-describedby="basic-addon1" name="descripcionImagen"></textarea>
					</div>
				</div>
				<div class="panel-footer">
					<button id="btnSubirImg" type="button" class="btn btn-primary">
					<span class="glyphicon glyphicon-picture"></span>&nbsp;&nbsp;Agregar Imágen</button>
				</div>
			</div>
			
		</div>

		<!--<div id="formVer">
			<div class="panel panel-primary">
				<div class="panel-heading">
					<h3 class="panel-title">Ver Imágenes</h3>
				</div>

				<div class="text-info">
					<h4 id="titulo">Titulo...</h4>
				</div>				

		        <div class="wrapper">

		            <div class="jcarousel-wrapper">
		                <div class="jcarousel">
		                    <ul id="listaImg">
		                        <!--<li style="background: url('../images/paisajes/01.jpg');"></li>
		                        <li style="background: url('../images/paisajes/02.jpg');"></li>
		                        <li style="background: url('../images/paisajes/03.jpg');"></li>
		                        <li style="background: url('../images/paisajes/04.jpg');"></li>
		                        <li style="background: url('../images/paisajes/05.jpg');"></li>
		                    </ul>
		                </div>

		                <p class="photo-credits">
		                    Photos by <a href="http://www.mw-fotografie.de">Marc Wiegelmann</a>
		                </p>

		                <a href="#" id="prev" class="jcarousel-control-prev">&lsaquo;</a>
		                <a href="#" id="next" class="jcarousel-control-next">&rsaquo;</a>
		            </div>

		        </div>		

		        <div class="text-info">
					<BLOCKQUOTE id="desc" >Descripcion...</BLOCKQUOTE>
				</div>

			</div>
		</div>-->

		<div id="formVer">
			<div class="panel panel-primary">
				<div class="panel-heading">
					<h3 class="panel-title">Ver Imágenes</h3>
				</div>
				<div class="panel-body ingreso">
					  <div id="myCarousel" class="carousel slide" data-ride="carousel">
					    <!-- Indicators -->
					    <ol class="carousel-indicators">
					      <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
					      <li data-target="#myCarousel" data-slide-to="1"></li>
					      <li data-target="#myCarousel" data-slide-to="2"></li>
					      <li data-target="#myCarousel" data-slide-to="3"></li>
					    </ol>

					    <!-- Wrapper for slides -->
					    <div class="carousel-inner" role="listbox">

					      <div class="item active">
					        <img src="../images/paisajes/01.jpg" alt="Chania" width="460" height="345">
					        <div class="carousel-caption">
					          <h3>Chania</h3>
					          <p>The atmosphere in Chania has a touch of Florence and Venice.</p>
					        </div>
					      </div>
					  
					    </div>

					    <!-- Left and right controls -->
					    <a class="left carousel-control" style="background: white" 
					    	href="#myCarousel" role="button" data-slide="prev">
					      <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
					      <span class="sr-only">Previous</span>
					    </a>
					    <a class="right carousel-control" style="background: white"
					    	href="#myCarousel" role="button" data-slide="next">
					      <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
					      <span class="sr-only">Next</span>
					    </a>
					  </div>

				</div>
			</div>
		</div>				

	</section>

	<footer class="footer">
		<div class="navbar navbar-inverse" role="navigation">
			<div class="glyphicon">
				<strong>Laboratorio 1 - RIA - 2015</strong>
			</div><br>
			<span><span class="glyphicon glyphicon-envelope"><strong>&nbsp;drimtim@gmail.com</strong></span>&nbsp;
			<img class="imagen" src="../images/logotipoMin.png" alt="DRIMTIM!">
           	<span><span class="glyphicon glyphicon-globe"><strong>&nbsp;www.drimtim.com</strong></span>&nbsp;			
		</div>
	</footer>	

	<script type="text/javascript">	

 		/* Copyright (c) 2006 Mathias Bank (http://www.mathias-bank.de)
 		* Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) 
 		* and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 		* 
 		* Thanks to Hinnerk Ruemenapf - http://hinnerk.ruemenapf.de/ for bug reporting and fixing.
 		*/
		jQuery.extend({
		/**
		* Returns get parameters.
		*
		* If the desired param does not exist, null will be returned
		*
		* @example value = $.getURLParam("paramName");
		*/ 
 			getURLParam: function(strParamName){
				var strReturn = "";
				var strHref = window.location.href;
				var bFound=false;
				  
				var cmpstring = strParamName + "=";
				var cmplen = cmpstring.length;

				if ( strHref.indexOf("?") > -1 ){
				  	var strQueryString = strHref.substr(strHref.indexOf("?")+1);
				    var aQueryString = strQueryString.split("&");
				    for ( var iParam = 0; iParam < aQueryString.length; iParam++ ){
				      	if (aQueryString[iParam].substr(0,cmplen)==cmpstring){
				        	var aParam = aQueryString[iParam].split("=");
				        	strReturn = aParam[1];
				        	bFound=true;
				        	break;
				      	}
				      
				    }
				}
				if (bFound==false) return null;
					return strReturn;
				}
			});

		var imagenCargada = null;
		var imagenesCargadas = new Array();	

		var nombreUsuario = $.getURLParam("nombreUsu");
		if(nombreUsuario != null && nombreUsuario != ""){ 
			var aux = '&nbsp;' + nombreUsuario.replace(/\+/g, " ");
			$("#nombreUsu").html(aux);
		}else{
			$("#nombreUsu").html(" Registrese!");	
		}

		$("#formVer").hide();

		function mostrarImagen2(input) {
 			if (input.files && input.files[0]) {
  				var reader = new FileReader();
  				reader.onload = function (e) {
   					$('#miniatura').attr('src', e.target.result);
   					imagenCargada = e.target.result;
  				}
  				reader.readAsDataURL(input.files[0]);
 			}
		}

		function mostrarImagen(titulo, imagen, descripcion){
			bootbox.dialog({
			  message: "<div><img src='" + imagen + "' class='imagenDetalle'/><h4>" + descripcion + "</h4></div>",
			  title: titulo,
			  buttons: {
		    	aceptar: {
		    		label: "Cerrar",
		      		className: "btn-primary",
		      		callback: function() {}
		    	}
			  }
			});
		}		

		function cargarImagen(event) {
			var files = event.target.files;
			var reader = new FileReader();
			var miniatura = document.getElementById("miniatura");
			for (var i = 0, file; file = files[i]; i++) {
				miniatura.title = file.name;
				reader.onload = function(event) {
					miniatura.src = event.target.result;
					imagenCargada = event.target.result;
				};
				reader.readAsDataURL(file);
			}
		}	

		function mostrarFuncionalidad(funcionalidad) {
			if (funcionalidad == "INGRESAR") {
				$("#formIngresar").show();
				$("#formVer").hide();
				$("#linkIngresar").attr("class", "active");
				$("#linkVer").attr("class", "");
			} else {
				$("#formIngresar").hide();
				$("#formVer").show();
				$("#linkIngresar").attr("class", "");
				$("#linkVer").attr("class", "active");
				mostrarImagenesCargadas();
			}

		}

		function mostrarImagenesCargadas(){
			$("#contenedorImagenes").html(null);
			if(imagenesCargadas.length > 0){
				$("#sinImagenes").hide();
				for(var i = 0; i < imagenesCargadas.length; i++){
					var titulo = imagenesCargadas[i].titulo;
					var imagen = imagenesCargadas[i].archivo;
					var descripcion = imagenesCargadas[i].descripcion;

					var item = 
						"<div class='item'>" +
					        "<img src='" + imagen + "'" + "alt='" + titulo + "'" + "width='500' height='350'>" + 
					        "<div class='carousel-caption'>" +
					        	"<h3>" + titulo + "</h3>" + 
					        "	<p>" + descripcion + "</p>" +
					        "</div>" +
					    "</div>";

					$('.carousel-inner').append(item);

				}
			}else{
				$("#sinImagenes").show();
			}
		}	
		
		function mostrarConfirmacion(titulo, mensaje, funcionAceptar){
			bootbox.dialog({
			  message: mensaje,
			  title: titulo,
			  buttons: {
			  	cancelar: {
				  label: "Cancelar",
			      className: "btn-primary",
			      callback: function() {}
		    	},
		    	aceptar: {
		    		label: "Aceptar",
		      		className: "btn-primary",
		      		callback: function() {
		        		funcionAceptar();
		      		}
		    	}
			  }
			});
		}

		function mostrarError(mensaje){
			bootbox.dialog({
			  message: mensaje,
			  title: "Error!",
			  buttons: {
		    	aceptar: {
		    		label: "Cerrar",
		      		className: "btn-primary",
		      		callback: function() {}
		    	}
			  }
			});
		}

		function guardarImagen(){
			var tituloImagen = $("#tituloImagen").val();
			var descripcionImagen = $("#descripcionImagen").val();
			if(imagenCargada != null && imagenCargada != "" && imagenCargada != undefined){
				if(tituloImagen != null && tituloImagen != "" && tituloImagen != undefined){
					if(descripcionImagen != null && descripcionImagen != "" && descripcionImagen != undefined){
						mostrarConfirmacion("Confirmación", "Esta seguro que desea guardar la imagen?", function (){
							var imagen = new Object();
							imagen.archivo = imagenCargada;
							imagen.titulo = tituloImagen;
							imagen.descripcion = descripcionImagen;
							imagenesCargadas[imagenesCargadas.length] = imagen;
							limpiarCampos();
						});
					}else{
						mostrarError("Debe ingresar una descripción!");
					}
				}else{
					mostrarError("Debe ingresar un titulo!");
				}
			}else{
				mostrarError("Debe seleccionar una imagen!");
			}		
		}

		function limpiarCampos(){
			$("#archivoImagen").val(null);
			$("#tituloImagen").val(null);
			$("#descripcionImagen").val(null);
			$("#miniatura").attr("src", null);
			$(":file").filestyle('clear');
		}
 
		/*$("#archivoImagen").change(function(){
 			cargarImagen(event);
		});*/

		$("#btnSubirImg").click(function(){
			guardarImagen();
 		});	

 		function aleatorio(inferior,superior){
    		var numPosibilidades = superior - inferior;
    		var aleat = Math.random() * numPosibilidades;
    		aleat = Math.round(aleat);
    		return parseInt(inferior) + aleat;
		}; 


	</script>

</body>
</html>