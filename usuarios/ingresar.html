<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script type="text/javascript" src="../js/jquery-2.1.3.min.js"></script>
<script type="text/javascript" src="../js/bootstrap.min.js"></script>
<script type="text/javascript" src="../js/bootstrap-select.js"></script>
<script type="text/javascript" src="../js/bootstrap-filestyle.min.js"></script>
<script type="text/javascript" src="../js/bootbox.min.js"></script>
<link rel="stylesheet" href="../css/bootstrap.min.css">
<link rel="stylesheet" href="../css/bootstrap-select.min.css">
<link rel="stylesheet" href="../css/style.css">
<title>RIA LAB - Ingreso</title>
</head>
<body>
	<header>
		<nav class="navbar navbar-default navbar-fixed-top">
			<div class="container">
				<h4>
					<span id="nombreUsuario" class="label label-default">Nombre de Usuario</span>
				</h4>
			</div>
		</nav>
		<br /> <br /> <br />
		<h1>
			Laboratorio 1<small> de </small>RIA
		</h1>
	</header>
	<section class="form">
		<ul class="nav nav-tabs">
			<li id="linkIngresar" role="presentation"><a href="#"
				onclick="mostrarFuncionalidad('INGRESAR');">Ingresar</a></li>
			<li id="linkVer" role="presentation"><a href="#"
				onclick="mostrarFuncionalidad('VER');">Ver</a></li>
		</ul>
		<div id="formIngresar">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">Ingresar Imágen</h3>
				</div>
				<div class="panel-body ingreso">
					<div class="img-thumbnail imagen">
						<img id="miniatura" src="..." alt="Imágen" name="imagenUsuario">
					</div>
					<div class="imagenBuscar">
						<input id="archivoImagen" type="file" class="filestyle" data-buttonName="btn-primary"
							data-buttonText="Cargar Imagen ..."
							data-iconName="glyphicon-inbox" data-buttonBefore="true"
							onchange="cargarImagen(event);">
					</div>
					<br />
					<div class="input-group">
						<span class="input-group-addon" id="basic-addon1">Titulo: </span>
						<input id="tituloImagen" type="text" class="form-control"
							placeholder="Ingrese el título de la imágen..."
							aria-describedby="basic-addon1" name="tituloImagen">
					</div>
					<br />
					<div class="input-group">
						<span class="input-group-addon" id="basic-addon1">Descripción:
						</span>
						<textarea id="descripcionImagen" class="form-control"
							placeholder="Ingrese una descripción de la imágen..."
							aria-describedby="basic-addon1" name="descripcionImagen"></textarea>
					</div>
				</div>
				<div class="panel-footer">
					<button id="botonLogin" type="button" class="btn btn-primary" onclick="guardarImagen();">Agregar Imágen</button>
				</div>
			</div>
		</div>
		<div id="formVer">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">Ver Imágenes</h3>
				</div>
				<div class="panel-body ingreso">
					<div id="contenedorImagenes" class="row"></div>
					<div id="imagenDeMuestra_" hidden="hidden" class="col-sm-6 col-md-4">
						<div class="thumbnail">
							<img id="imagenDeMuestra_archivo_" src="../images/LOGO.png" alt="IMAGEN">
							<div class="caption">
								<h3 id="imagenDeMuestra_titulo_">Titulo</h3>
								<p id="imagenDeMuestra_descripcion_">Descripcion</p>
							</div>
						</div>
					</div>
					<div id="sinImagenes" hidden="hidden" class="panel panel-info">
						<div class="panel-heading">
							<h3 class="panel-title">Aviso</h3>
						</div>
						<div class="panel-body">
							No hay imagenes cargadas para mostrar.
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<footer class="footer">
		<div class="navbar navbar-inverse navbar-fixed-bottom" role="navigation">
			<br>LABORATORIO DE APLICACIONES DE INTERNET RICAS
		</div>
	</footer>
</body>
<script type="text/javascript">
	var imagenCargada = null;
	var imagenesCargadas = new Array();
	
	$(document).ready(function() {
		var nombreUsuario = getParameterByName("nombreUsuario");
		var ingresar = getParameterByName("ingresar");
		$("#nombreUsuario").html(nombreUsuario);
		mostrarFuncionalidad(ingresar);
	});
	function mostrarFuncionalidad(funcionalidad) {
		if (funcionalidad == "INGRESAR") {
			$("#formIngresar").show();
			$("#formVer").hide();
			$("#linkIngresar").attr("class", "active");
			$("#linkVer").attr("class", "");
		} else {
			$("#formIngresar").hide();
			$("#formVer").show();
			$("#linkIngresar").attr("class", "");
			$("#linkVer").attr("class", "active");
			mostrarImagenesCargadas();
		}
	}
	function mostrarImagenesCargadas(){
		$("#contenedorImagenes").html(null);
		if(imagenesCargadas.length > 0){
			$("#sinImagenes").hide();
			for(var i = 0; i < imagenesCargadas.length; i++){
				var clone = $("#imagenDeMuestra_").clone();
				clone.attr("id", "imagenDeMuestra_" + i);
				clone.find("#imagenDeMuestra_archivo_").attr("id", "imagenDeMuestra_archivo_" + i);
				clone.find("#imagenDeMuestra_titulo_").attr("id", "imagenDeMuestra_titulo_" + i);
				clone.find("#imagenDeMuestra_descripcion_").attr("id", "imagenDeMuestra_descripcion_" + i);
				clone.show();
				$("#contenedorImagenes").append(clone);
				
				$("#imagenDeMuestra_archivo_" + i).attr("src", imagenesCargadas[i].archivo);
				$("#imagenDeMuestra_titulo_" + i).html(imagenesCargadas[i].titulo);
				$("#imagenDeMuestra_descripcion_" + i).html(imagenesCargadas[i].descripcion);
			}
		}else{
			$("#sinImagenes").show();
		}
	}
	function getParameterByName(name) {
		name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
		var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"), results = regex.exec(location.search);
		return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
	}
	function cargarImagen(event) {
		var files = event.target.files;
		var reader = new FileReader();
		var miniatura = document.getElementById("miniatura");
		for (var i = 0, file; file = files[i]; i++) {
			miniatura.title = file.name;
			reader.onload = function(event) {
				miniatura.src = event.target.result;
				imagenCargada = event.target.result;
			};
			reader.readAsDataURL(file);
		}
	}
	
	function mostrarConfirmacion(titulo, mensaje, funcionAceptar){
		bootbox.dialog({
		  message: mensaje,
		  title: titulo,
		  buttons: {
		  	cancelar: {
			  label: "Cancelar",
		      className: "btn-primary",
		      callback: function() {}
	    	},
	    	aceptar: {
	    		label: "Aceptar",
	      		className: "btn-primary",
	      		callback: function() {
	        		funcionAceptar();
	      		}
	    	}
		  }
		});
	}
	
	function mostrarError(mensaje){
		bootbox.dialog({
		  message: mensaje,
		  title: "Error!",
		  buttons: {
	    	aceptar: {
	    		label: "Cerrar",
	      		className: "btn-primary",
	      		callback: function() {}
	    	}
		  }
		});
	}
	function guardarImagen(){
		var tituloImagen = $("#tituloImagen").val();
		var descripcionImagen = $("#descripcionImagen").val();
		if(imagenCargada != null && imagenCargada != "" && imagenCargada != undefined){
			if(tituloImagen != null && tituloImagen != "" && tituloImagen != undefined){
				if(descripcionImagen != null && descripcionImagen != "" && descripcionImagen != undefined){
					mostrarConfirmacion("Confirmación", "Esta seguro que desea guardar la imagen?", function (){
						var imagen = new Object();
						imagen.archivo = imagenCargada;
						imagen.titulo = tituloImagen;
						imagen.descripcion = descripcionImagen;
						imagenesCargadas[imagenesCargadas.length] = imagen;
						limpiarCampos();
					});
				}else{
					mostrarError("Debe ingresar una descripción!");
				}
			}else{
				mostrarError("Debe ingresar un titulo!");
			}
		}else{
			mostrarError("Debe seleccionar una imagen!");
		}		
	}
	function limpiarCampos(){
		$("#archivoImagen").val(null);
		$("#tituloImagen").val(null);
		$("#descripcionImagen").val(null);
		$("#miniatura").attr("src", null);
		$(":file").filestyle('clear');
	}
</script>
</html>